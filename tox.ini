[tox]
envlist = build
          docs
          man
          pipfile
          py36
          py36-setproctitle
          py36-uvloop
          setup.py

[testenv]
deps = pyannotate
       pycodestyle<2.4.0,>=2.0.0
       pydocstyle
       pyflakes<1.7.0,>=1.5.0
       pylama
       pytest
       pytest-asyncio
       pytest-cov
       pytest-pride
       radon
commands = py.test -c setup.cfg --pylama --cache-clear -q blackhole tests
           radon mi -nc blackhole

[testenv:py36]
basepython = python3.6

[testenv:py36-setproctitle]
basepython = python3.6
deps = {[testenv]deps}
       setproctitle

[testenv:py36-uvloop]
basepython = python3.6
deps = {[testenv]deps}
       uvloop

[testenv:py37]
basepython = python3.7

[testenv:py37-setproctitle]
basepython = python3.7
deps = {[testenv]deps}
       setproctitle

[testenv:py37-uvloop]
basepython = python3.7
deps = {[testenv]deps}
       uvloop

[testenv:build]
skip_install = True
deps = wheel
commands = python setup.py sdist bdist_wheel

[testenv:docs]
deps = sphinx
       guzzle_sphinx_theme
changedir = docs/source
commands = sphinx-build -d {envtmpdir}/doctrees . {envtmpdir}/html -c .
           sphinx-build -b linkcheck -d {envtmpdir}/doctrees . {envtmpdir}/html -c .

[testenv:man]
skip_install = True
deps = docutils
commands = rst2man.py man/source/blackhole.rst {envtmpdir}/blackhole.1
           rst2man.py man/source/blackhole_config.rst {envtmpdir}/blackhole_config.1

[testenv:pipfile]
skip_install = True
deps = pipenv
commands = pipenv check
           pipenv install

[testenv:pre-commit]
skip_install = true
deps = pre-commit
commands = pre-commit run --all-files --verbose

[testenv:setup.py]
deps = docutils
skip_install = true
commands = python setup.py check -r -s -m

[testenv:shellcheck]
skip_install = true
commands = shellcheck -x scripts/*.sh \
    bash-completion/blackhole-completion.bash \
    init.d/debian-ubuntu/blackhole
